<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.R.O Cleaning Service - Price Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="config.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        header h1 { font-size: 2.5em; margin-bottom: 10px; }
        header h1 i { margin-right: 10px; }
        .admin-link {
            position: absolute;
            top: 30px;
            right: 30px;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border: 2px solid white;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .admin-link:hover {
            background: white;
            color: #667eea;
        }
        .form-section { padding: 30px; border-bottom: 1px solid #eee; }
        .form-section h2 { color: #333; margin-bottom: 20px; }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group { margin-bottom: 15px; }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .radio-option {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .radio-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        .radio-option.selected {
            border-color: #667eea;
            background: #f0f3ff;
        }
        .radio-option i {
            font-size: 24px;
            color: #667eea;
            margin-right: 10px;
        }
        .package-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .package-option {
            position: relative;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .package-option:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102,126,234,0.1);
        }
        .package-option.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }
        .package-option input[type="radio"] {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .package-details h3 { 
            color: #333; 
            margin-bottom: 10px;
            padding-right: 30px;
        }
        .package-details .price {
            color: #667eea;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .package-details .description {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        .addons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .addon-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .addon-item:hover { 
            background: #f8f9ff;
            border-color: #667eea;
        }
        .addon-item input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .addon-item .addon-name { flex: 1; color: #555; }
        .addon-item .addon-price { 
            color: #667eea; 
            font-weight: bold; 
            margin-right: 5px;
            background: #f0f3ff;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        .price-section {
            padding: 30px;
            background: #f8f9ff;
            text-align: center;
        }
        .price-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: inline-block;
        }
        #totalPrice {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
        }
        .price-breakdown {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            text-align: left;
            max-width: 600px;
            margin: 20px auto 0;
        }
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .breakdown-item.total {
            font-weight: bold;
            font-size: 1.2em;
            border-top: 2px solid #f0f0f0;
            margin-top: 10px;
            padding-top: 15px;
        }
        .info-badge {
            background: #f0f3ff;
            color: #667eea;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .submit-btn {
            display: block;
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        .submit-btn:hover { opacity: 0.9; }
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .loading-spinner { text-align: center; }
        .loading-spinner i {
            font-size: 50px;
            color: #667eea;
            margin-bottom: 20px;
        }
        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
            text-align: center;
        }
        .error-message {
            color: #ff6b6b;
            font-size: 0.85em;
            margin-top: 5px;
            display: none;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1500;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto;
        }
        .modal-content {
            background-color: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 900px;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .close-modal {
            position: absolute;
            right: 25px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            z-index: 1;
        }
        .close-modal:hover {
            color: #333;
        }
        .modal h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-right: 30px;
        }
        .modal h3 {
            color: #764ba2;
            margin: 20px 0 10px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 5px;
        }
        .modal ul {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        .modal ul li {
            padding: 8px 0 8px 25px;
            position: relative;
            background: #f8f9ff;
            border-radius: 5px;
            margin: 2px 0;
        }
        .modal ul li:before {
            content: "✓";
            color: #667eea;
            position: absolute;
            left: 8px;
            font-weight: bold;
        }
        .modal .note {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.95em;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        .modal .important-note {
            background: #f8d7da;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #721c24;
            border-left: 4px solid #f5c6cb;
        }
        .modal .ideal-for {
            background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .modal .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .modal .product-item {
            background: #f0f3ff;
            padding: 8px 12px;
            border-radius: 20px;
            text-align: center;
            font-size: 0.9em;
            color: #667eea;
            border: 1px solid #667eea20;
        }
        .package-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        @media (max-width: 768px) {
            header h1 { font-size: 1.8em; }
            .form-section { padding: 20px; }
            .package-grid { grid-template-columns: 1fr; }
            #totalPrice { font-size: 2em; }
            .modal-content { margin: 20px; padding: 20px; }
            .modal ul { grid-template-columns: 1fr; }
            .admin-link {
                position: static;
                display: inline-block;
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-broom"></i> K.R.O Cleaning Service</h1>
            <p>Get an instant price quote for your cleaning needs</p>
            <a href="admin.html" class="admin-link"><i class="fas fa-cog"></i> Admin</a>
        </header>

        <form id="pricingForm">
            <div class="form-section">
                <h2>Your Details</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="fullName">Full Name *</label>
                        <input type="text" id="fullName" required>
                        <div class="error-message" id="nameError">Please enter your full name</div>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" required>
                        <div class="error-message" id="emailError">Please enter a valid email</div>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input type="tel" id="phone" required>
                        <div class="error-message" id="phoneError">Please enter your phone number</div>
                    </div>
                    <div class="form-group">
                        <label for="address">Property Address *</label>
                        <input type="text" id="address" required>
                        <div class="error-message" id="addressError">Please enter the property address</div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>Property Type</h2>
                <div class="radio-group">
                    <label class="radio-option" id="residentialOption">
                        <input type="radio" name="propertyType" value="residential" style="display: none;"> 
                        <i class="fas fa-home"></i> Residential
                    </label>
                    <label class="radio-option" id="commercialOption">
                        <input type="radio" name="propertyType" value="commercial" style="display: none;"> 
                        <i class="fas fa-building"></i> Commercial
                    </label>
                </div>
            </div>

            <!-- Package Selection - Residential -->
            <div class="form-section" id="residentialPackages">
                <h2>Select Residential Package</h2>
                <div class="package-grid" id="residentialPackagesGrid"></div>
            </div>

            <!-- Package Selection - Commercial -->
            <div class="form-section" id="commercialPackages" style="display: none;">
                <h2>Select Commercial Package</h2>
                <div class="package-grid" id="commercialPackagesGrid"></div>
            </div>

            <!-- Frequency Selection -->
            <div class="form-section">
                <h2>Cleaning Frequency</h2>
                <select id="frequency">
                    <option value="onetime">One Time (No discount)</option>
                    <option value="twicemonth">Twice a month (3% off)</option>
                    <option value="onceweek">Once a week (5% off)</option>
                    <option value="twiceweek">2x a week (7% off)</option>
                    <option value="threeweek">3x a week (8% off)</option>
                    <option value="fiveweek">5x a week (10% off)</option>
                    <option value="everyday">Everyday (16% off)</option>
                </select>
            </div>

            <!-- Room Details - Residential -->
            <div class="form-section" id="residentialDetails">
                <h2>Room Details</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="bedrooms">Bedrooms:</label>
                        <input type="number" id="bedrooms" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="bathrooms">Bathrooms:</label>
                        <input type="number" id="bathrooms" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="livingrooms">Living Rooms:</label>
                        <input type="number" id="livingrooms" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="kitchens">Kitchens:</label>
                        <input type="number" id="kitchens" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="guestToilet">Guest Toilet:</label>
                        <input type="number" id="guestToilet" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="laundry">Laundry Room:</label>
                        <input type="number" id="laundry" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="study">Study Room:</label>
                        <input type="number" id="study" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="store">Store Room:</label>
                        <input type="number" id="store" min="0" value="0">
                    </div>
                </div>
            </div>

            <!-- Room Details - Commercial -->
            <div class="form-section" id="commercialDetails" style="display: none;">
                <h2>Commercial Space Details</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="offices">Offices:</label>
                        <input type="number" id="offices" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="restrooms">Restrooms:</label>
                        <input type="number" id="restrooms" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="reception">Reception:</label>
                        <select id="reception">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="commercialKitchen">Kitchenette:</label>
                        <input type="number" id="commercialKitchen" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="canteen">Canteen:</label>
                        <input type="number" id="canteen" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="lounge">Lounge:</label>
                        <input type="number" id="lounge" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="studyLibrary">Study/Library:</label>
                        <input type="number" id="studyLibrary" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="laundryRoom">Laundry Room:</label>
                        <input type="number" id="laundryRoom" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="storeRoom">Store Room:</label>
                        <input type="number" id="storeRoom" min="0" value="0">
                    </div>
                </div>
            </div>

            <!-- Add-ons Section -->
            <div class="form-section">
                <h2>Additional Services</h2>
                <div class="addons-grid" id="addonsContainer"></div>
            </div>

            <!-- Stain Remover Section -->
            <div class="form-section" id="stainRemoverSection">
                <h2>Stain Remover Options</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="stainRemover">Select Stain Remover Package:</label>
                        <select id="stainRemover">
                            <option value="none">None</option>
                            <option value="basic">Basic Stain Remover</option>
                            <option value="advanced">Advanced Stain Remover</option>
                            <option value="premium">Premium Stain Remover</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Additional Cleaners -->
            <div class="form-section">
                <h2>Additional Requirements</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="additionalCleaners">Additional Cleaners:</label>
                        <input type="number" id="additionalCleaners" min="0" value="0">
                    </div>
                </div>
            </div>

            <!-- Price Display -->
            <div class="price-section">
                <h2>Estimated Price</h2>
                <div class="price-box">
                    <span id="totalPrice">₦0</span>
                </div>
                <div class="price-breakdown" id="priceBreakdown"></div>
            </div>

            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i> Quote submitted successfully! We'll contact you shortly.
            </div>

            <button type="button" id="submitBtn" class="submit-btn">
                <i class="fas fa-paper-plane"></i> Get Quote & Submit
            </button>
        </form>
    </div>

    <!-- Package Information Modal -->
    <div id="packageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <h3>Loading pricing data...</h3>
        </div>
    </div>

    <script>
        // CONFIG - Using single API URL
        const CONFIG = window.KRO_CONFIG || {
            API_URL: 'https://script.google.com/macros/s/AKfycbwFUdZcSWWcfXHhqNg9Y1L0EA-mwv9-qcS3UQqk-s0J0XEYbBA9O86yQ9S6nS6I6sM/exec',
            API_SECRET_TOKEN: 'f92eb205-40c7-4a21-a02a-9f4a2422ae74',
            CURRENCY: '₦',
            COMPANY_PHONE: '+234 704 918 9964'
        };

        // Stain remover pricing (base values)
        const stainRemoverPrices = {
            residential: {
                basic: 6000,
                advanced: 9500,
                premium: 38000
            },
            commercial: {
                basic: 9500,
                advanced: 26500,
                premium: 65500
            }
        };

        // Package information from PDFs
        const packageInfo = {
            'residential-standard': {
                title: 'Standard Cleaning Package',
                ideal: 'Regular maintenance cleaning for homes',
                duration: '3-14 hours with 1-3 cleaners',
                note: 'Please note that the cleaner will not be coming with cleaning products. They will be using the cleaning products you provide to give you a clean home. Homes significantly larger than other homes of the same size and bookings that run longer than the estimated booking time might attract additional charges which will be duly communicated by our Booking Support Team.',
                sections: {
                    'Bedrooms': [
                        'Dusting of furniture and surfaces',
                        'Making bed',
                        'Sweeping and/or mopping floors',
                        'Dusting and wiping of skirting',
                        'Folding or hanging of up to 10 clothes',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ],
                    'Bathrooms': [
                        'Cleaning of shower, bath, and sinks',
                        'Wiping of counters and taps',
                        'Wiping of walls and mirrors',
                        'Mopping floors',
                        'Wiping outside of cupboards and cabinets',
                        'Toilet cleaning',
                        'Folding or hanging of clean towels',
                        'Emptying bins and cleaning bin area',
                        'Cleaning out cobwebs'
                    ],
                    'Kitchens': [
                        'Wiping of surfaces, sinks, and appliances',
                        'Washing of dishes',
                        'Wiping outside of cupboards and fridge',
                        'Cleaning the Stove top and walls behind stove',
                        'Cleaning inside and outside of microwave',
                        'Wiping of walls',
                        'Emptying bins and cleaning bin area',
                        'Mopping floors',
                        'Cleaning out cobwebs'
                    ],
                    'Living Areas': [
                        'Dusting of furniture and surfaces',
                        'Mopping and sweeping of floors',
                        'Dusting and wiping of skirting',
                        'Dusting and wiping electronics, picture frames',
                        'Dusting and wiping of light switches',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ]
                },
                products: [
                    'Broom', 'Mop', 'Moping bucket', 'Packer', 'Dust bin',
                    'Dustbin bags', 'Scrubbing brush', 'Rags', 'Buckets', 'Bowls',
                    'Bleach', 'Floor cleaner and/or soap', 'Dish soap and sponges',
                    'Scouring powder', 'Deep-action stain remover', 'Glass cleaner',
                    'Cobweb broom', 'Duster', 'Air freshener'
                ],
                notes: [
                    'Cleaning of Staircases within the home is also covered',
                    'Shipping fee covers only one cleaner',
                    'Folding of more than 10 items of clothing attracts additional charges',
                    'Prices depend on size & condition of the space',
                    'Outside-zone locations may attract transport fees'
                ]
            },
            'residential-deep': {
                title: 'Deep Cleaning Package',
                ideal: 'Thorough, in-depth cleaning of your home',
                duration: '3-14 hours with 1-3 cleaners',
                note: 'Please note that the cleaner will not be coming with cleaning products. They will be using the cleaning products you provide to give you a clean home. Homes significantly larger than other homes of the same size and bookings that run longer than the estimated booking time might attract additional charges which will be duly communicated by our Booking Support Team.',
                sections: {
                    'Bedrooms': [
                        'Dusting of furniture and surfaces',
                        'Making bed',
                        'Sweeping and/or mopping floors',
                        'Dusting and wiping of skirting',
                        'Folding or hanging of up to 10 clothes',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs',
                        'Deep cleaning of all surfaces'
                    ],
                    'Bathrooms': [
                        'Cleaning of shower, bath, and sinks',
                        'Wiping of counters and taps',
                        'Wiping of walls and mirrors',
                        'Mopping floors',
                        'Wiping outside of cupboards and cabinets',
                        'Toilet cleaning',
                        'Folding or hanging of clean towels',
                        'Emptying bins and cleaning bin area',
                        'Cleaning out cobwebs',
                        'Deep scrubbing of all surfaces'
                    ],
                    'Kitchens': [
                        'Wiping of surfaces, sinks, and appliances',
                        'Washing of dishes',
                        'Wiping outside of cupboards and fridge',
                        'Cleaning the Stove top and walls behind stove',
                        'Cleaning inside and outside of microwave',
                        'Wiping of walls',
                        'Emptying bins and cleaning bin area',
                        'Mopping floors',
                        'Cleaning out cobwebs',
                        'Deep cleaning of all appliances'
                    ]
                },
                products: [
                    'Broom', 'Mop', 'Moping bucket', 'Packer', 'Dust bin',
                    'Dustbin bags', 'Scrubbing brush', 'Rags', 'Buckets', 'Bowls',
                    'Bleach', 'Floor cleaner and/or soap', 'Dish soap and sponges',
                    'Scouring powder', 'Deep-action stain remover', 'Glass cleaner',
                    'Cobweb broom', 'Duster', 'Air freshener'
                ],
                notes: [
                    'Cleaning of Staircases within the home is also covered',
                    'Shipping fee covers only one cleaner',
                    'Prices depend on size & condition of the space',
                    'Outside-zone locations may attract transport fees'
                ]
            },
            'residential-movein': {
                title: 'Move-In Cleaning Package',
                ideal: 'Thorough cleaning of your new home before moving in',
                duration: '3-14 hours with 1-3 cleaners',
                note: 'Please note that the cleaner will not be coming with cleaning products. They will be using the cleaning products you provide to give you a clean home. Homes significantly larger than other homes of the same size and bookings that run longer than the estimated booking time might attract additional charges which will be duly communicated by our Booking Support Team.',
                sections: {
                    'Bedrooms': [
                        'Dusting and wiping of skirting',
                        'Dusting of furniture and surfaces',
                        'Making bed',
                        'Sweeping and/or mopping floors',
                        'Folding or hanging clothes',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ],
                    'Bathrooms': [
                        'Cleaning of shower, bath, and sinks',
                        'Wiping of counters and taps',
                        'Wiping of walls and mirrors',
                        'Mopping floors',
                        'Wiping outside of cupboards and cabinets',
                        'Toilet cleaning',
                        'Folding or hanging of clean towels',
                        'Emptying bins and cleaning bin area',
                        'Cleaning out cobwebs'
                    ],
                    'Kitchens': [
                        'Wiping of surfaces, sinks, and appliances',
                        'Washing of dishes',
                        'Wiping outside of cupboards and fridge',
                        'Cleaning the Stove top and walls behind stove',
                        'Cleaning inside and outside of microwave',
                        'Wiping of walls',
                        'Emptying bins and cleaning bin area',
                        'Mopping floors',
                        'Cleaning out cobwebs'
                    ]
                },
                products: [
                    'Broom', 'Mop', 'Packer', 'Dustbin bags', 'Scrubbing brush',
                    'Rags', 'Bucket', 'Bowl', 'Bleach', 'Floor cleaner or soap',
                    'Toilet cleaner', 'Cleaning Chemicals', 'Glass cleaner', 'Air freshener'
                ],
                notes: [
                    'Cleaning of Staircases within the home is also covered',
                    'Shipping fee covers only one cleaner',
                    'Prices depend on size & condition of the space',
                    'Outside-zone locations may attract transport fees'
                ]
            },
            'commercial-small': {
                title: 'Small Office Cleaning Package',
                ideal: 'Startups, NGOs, clinics, small offices (5-10 staff)',
                space: '1-3 offices + reception + restroom',
                staff: '1-2 cleaners',
                duration: '3-14 hours',
                note: 'Company significantly larger than other companies of the same size and bookings that run longer than the estimated booking time might attract additional charges which will be duly communicated by our Booking Support Team.',
                sections: {
                    'Reception': [
                        'Dusting of furniture and surfaces',
                        'Mopping and sweeping of floors',
                        'Dusting and wiping of skirting',
                        'Dusting and wiping electronics, picture frames',
                        'Dusting and wiping of light switches and fixtures',
                        'Emptying bins and cleaning bin area',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ],
                    'Restroom': [
                        'Cleaning of shower, bath, and sinks',
                        'Wiping of counters and taps',
                        'Wiping of walls and mirrors',
                        'Mopping floors',
                        'Wiping outside of cupboards and cabinets',
                        'Toilet cleaning',
                        'Folding or hanging of clean towels',
                        'Emptying bins and cleaning bin area',
                        'Cleaning out cobwebs'
                    ],
                    'Office': [
                        'Dusting of furniture and surfaces',
                        'Arranging tables and stationary',
                        'Sweeping and mopping floors',
                        'Dusting and wiping of skirting',
                        'Emptying bins and cleaning bin area',
                        'Dusting and wiping electronics, picture frames',
                        'Dusting and wiping of light switches',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ],
                    'Kitchenette': [
                        'Wiping of surfaces, sinks, and appliances',
                        'Washing of dishes',
                        'Wiping outside of cupboards and fridge',
                        'Cleaning the Stove top and walls behind stove',
                        'Cleaning inside and outside of microwave',
                        'Wiping of walls',
                        'Emptying bins and cleaning bin area',
                        'Mopping floors',
                        'Cleaning out cobwebs'
                    ]
                },
                notes: [
                    'Shipping fee covers only one cleaner',
                    'If additional cleaners required, extra fee applies',
                    'Folding of more than 10 clothing items attracts additional charges',
                    'Prices depend on size & condition of space',
                    'Outside-zone locations may attract transport fees'
                ]
            },
            'commercial-standard': {
                title: 'Standard Office Cleaning Package',
                ideal: 'Corporate offices, law firms, real estate firms, small schools',
                space: '4-8 offices + reception + toilets',
                staff: '2-3 cleaners',
                duration: '3-14 hours',
                note: 'Company significantly larger than other companies of the same size and bookings that run longer than the estimated booking time might attract additional charges which will be duly communicated by our Booking Support Team.',
                sections: {
                    'Reception': [
                        'Dusting of furniture and surfaces',
                        'Mopping and sweeping of floors',
                        'Dusting and wiping of skirting',
                        'Dusting and wiping electronics, picture frames',
                        'Dusting and wiping of light switches and fixtures',
                        'Emptying bins and cleaning bin area',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ],
                    'Restroom': [
                        'Cleaning of shower, bath, and sinks',
                        'Wiping of counters and taps',
                        'Wiping of walls and mirrors',
                        'Mopping floors',
                        'Wiping outside of cupboards and cabinets',
                        'Toilet cleaning',
                        'Folding or hanging of clean towels',
                        'Emptying bins and cleaning bin area',
                        'Cleaning out cobwebs'
                    ],
                    'Office': [
                        'Dusting of furniture and surfaces',
                        'Arranging tables and stationary',
                        'Sweeping and mopping floors',
                        'Dusting and wiping of skirting',
                        'Emptying bins and cleaning bin area',
                        'Dusting and wiping electronics, picture frames',
                        'Dusting and wiping of light switches',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ]
                },
                notes: [
                    'Shipping fee covers only one cleaner',
                    'If additional cleaners required, extra fee applies',
                    'Folding of more than 10 clothing items attracts additional charges',
                    'Prices depend on size & condition of space',
                    'Outside-zone locations may attract transport fees'
                ]
            },
            'commercial-large': {
                title: 'Large Office Cleaning Package',
                ideal: 'Banks, ministries, large NGOs, schools, hospitals (non-theatre)',
                space: '9-20+ offices, halls & corridors',
                staff: '4-6 cleaners',
                duration: '3-14 hours',
                note: 'Company significantly larger than other companies of the same size and bookings that run longer than the estimated booking time might attract additional charges which will be duly communicated by our Booking Support Team.',
                sections: {
                    'Reception': [
                        'Dusting of furniture and surfaces',
                        'Mopping and sweeping of floors',
                        'Dusting and wiping of skirting',
                        'Dusting and wiping electronics, picture frames',
                        'Dusting and wiping of light switches and fixtures',
                        'Emptying bins and cleaning bin area',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ],
                    'Restroom': [
                        'Cleaning of shower, bath, and sinks',
                        'Wiping of counters and taps',
                        'Wiping of walls and mirrors',
                        'Mopping floors',
                        'Wiping outside of cupboards and cabinets',
                        'Toilet cleaning',
                        'Folding or hanging of clean towels',
                        'Emptying bins and cleaning bin area',
                        'Cleaning out cobwebs'
                    ],
                    'Office': [
                        'Dusting of furniture and surfaces',
                        'Arranging tables and stationary',
                        'Sweeping and mopping floors',
                        'Dusting and wiping of skirting',
                        'Emptying bins and cleaning bin area',
                        'Dusting and wiping electronics, picture frames',
                        'Dusting and wiping of light switches',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ]
                },
                notes: [
                    'Shipping fee covers only one cleaner',
                    'If additional cleaners required, extra fee applies',
                    'Folding of more than 10 clothing items attracts additional charges',
                    'Prices depend on size & condition of space',
                    'Outside-zone locations may attract transport fees'
                ]
            },
            'commercial-onetime': {
                title: 'One-Time Deep Cleaning Package',
                ideal: 'End-of-year cleaning, post-renovation, inspections, reopening',
                staff: '4-8 cleaners',
                duration: '3-14 hours',
                note: 'Company significantly larger than other companies of the same size and bookings that run longer than the estimated booking time might attract additional charges which will be duly communicated by our Booking Support Team.',
                sections: {
                    'Reception': [
                        'Dusting of furniture and surfaces',
                        'Mopping and sweeping of floors',
                        'Dusting and wiping of skirting',
                        'Dusting and wiping electronics, picture frames',
                        'Dusting and wiping of light switches and fixtures',
                        'Emptying bins and cleaning bin area',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ],
                    'Restroom': [
                        'Cleaning of shower, bath, and sinks',
                        'Wiping of counters and taps',
                        'Wiping of walls and mirrors',
                        'Mopping floors',
                        'Wiping outside of cupboards and cabinets',
                        'Toilet cleaning',
                        'Folding or hanging of clean towels',
                        'Emptying bins and cleaning bin area',
                        'Cleaning out cobwebs'
                    ],
                    'Office': [
                        'Dusting of furniture and surfaces',
                        'Arranging tables and stationary',
                        'Sweeping and mopping floors',
                        'Dusting and wiping of skirting',
                        'Emptying bins and cleaning bin area',
                        'Dusting and wiping electronics, picture frames',
                        'Dusting and wiping of light switches',
                        'Cleaning Mirrors',
                        'Cleaning out cobwebs'
                    ]
                },
                notes: [
                    'Shipping fee covers only one cleaner',
                    'If additional cleaners required, extra fee applies',
                    'Folding of more than 10 clothing items attracts additional charges',
                    'Prices depend on size & condition of space',
                    'Outside-zone locations may attract transport fees'
                ]
            }
        };

        // Default pricing (will be overridden by Google Sheets)
        let pricing = {
            residential: {
                standard: { 
                    base: 9000, 
                    extraHourRate: 2800,
                    rooms: { 
                        bedroom: 1300, bathroom: 1000, living: 1200, kitchen: 1500,
                        guestToilet: 800, laundry: 800, study: 800, store: 800 
                    } 
                },
                deep: { 
                    base: 41400, 
                    extraHourRate: 3800,
                    rooms: { 
                        bedroom: 4400, bathroom: 4100, living: 4200, kitchen: 4600,
                        guestToilet: 2800, laundry: 5600, study: 5600, store: 5700 
                    } 
                },
                movein: { 
                    base: 51000, 
                    extraHourRate: 3800,
                    rooms: { 
                        bedroom: 5000, bathroom: 4800, living: 5000, kitchen: 5200,
                        guestToilet: 3300, laundry: 7300, study: 7800, store: 6800 
                    } 
                }
            },
            commercial: {
                small: { 
                    base: 45000, 
                    extraHourRate: 5800,
                    rooms: { office: 10000, restroom: 19000, reception: 16000 } 
                },
                standard: { 
                    base: 96000, 
                    extraHourRate: 9500,
                    rooms: { office: 27000, restroom: 36000, reception: 33000 } 
                },
                large: { 
                    base: 150000, 
                    extraHourRate: 14000,
                    rooms: { office: 45000, restroom: 54000, reception: 51000 } 
                },
                onetime: { 
                    base: 249000, 
                    extraHourRate: 20000,
                    rooms: { office: 78000, restroom: 87000, reception: 84000 } 
                }
            }
        };

        let addons = {
            residential: [],
            commercial: []
        };

        const frequencyDiscounts = {
            onetime: 0, twicemonth: 3, onceweek: 5, twiceweek: 7, threeweek: 8, fiveweek: 10, everyday: 16
        };

        const additionalCleanerCost = {
            residential: 5000,
            commercial: { small: 10000, standard: 22500, large: 35000, onetime: 40000 }
        };

        // DOM Elements
        const propertyTypeRadios = document.querySelectorAll('input[name="propertyType"]');
        const residentialPackages = document.getElementById('residentialPackages');
        const commercialPackages = document.getElementById('commercialPackages');
        const residentialPackagesGrid = document.getElementById('residentialPackagesGrid');
        const commercialPackagesGrid = document.getElementById('commercialPackagesGrid');
        const residentialDetails = document.getElementById('residentialDetails');
        const commercialDetails = document.getElementById('commercialDetails');
        const addonsContainer = document.getElementById('addonsContainer');
        const frequencySelect = document.getElementById('frequency');
        const totalPriceSpan = document.getElementById('totalPrice');
        const priceBreakdown = document.getElementById('priceBreakdown');
        const submitBtn = document.getElementById('submitBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const successMessage = document.getElementById('successMessage');
        const modal = document.getElementById('packageModal');
        const modalContent = document.getElementById('modalContent');
        const residentialOption = document.getElementById('residentialOption');
        const commercialOption = document.getElementById('commercialOption');
        const stainRemoverSelect = document.getElementById('stainRemover');

        let currentPropertyType = 'residential';
        let currentResidentialPackage = 'standard';
        let currentCommercialPackage = 'small';

        // Load pricing data from Google Sheets (SINGLE API)
        async function loadPricingData() {
            loadingOverlay.style.display = 'flex';
            try {
                const response = await fetch(CONFIG.API_URL + '?action=getPricing');
                const data = await response.json();
                if (data.result === 'success' && data.data) {
                    pricing = data.data;
                    updatePackages();
                    updateAddons();
                    calculatePrice();
                } else {
                    // Use defaults if API fails
                    updatePackages();
                    updateAddons();
                    calculatePrice();
                }
            } catch (error) {
                console.log('Using default pricing data');
                updatePackages();
                updateAddons();
                calculatePrice();
            } finally {
                loadingOverlay.style.display = 'none';
            }
        }

        function updatePackages() {
            // Update Residential Packages
            let residentialHtml = '';
            const residentialPackages_list = [
                { id: 'standard', name: 'Standard Cleaning', price: pricing.residential.standard.base, desc: 'Regular maintenance cleaning' },
                { id: 'deep', name: 'Deep Cleaning', price: pricing.residential.deep.base, desc: 'Thorough, in-depth cleaning' },
                { id: 'movein', name: 'Move-In Cleaning', price: pricing.residential.movein.base, desc: 'For your new home' }
            ];
            
            residentialPackages_list.forEach(pkg => {
                residentialHtml += `
                    <div class="package-option ${currentResidentialPackage === pkg.id ? 'selected' : ''}" onclick="selectResidentialPackage('${pkg.id}')">
                        <input type="radio" name="residentialPackage" value="${pkg.id}" ${currentResidentialPackage === pkg.id ? 'checked' : ''} style="display: none;">
                        <div class="package-details">
                            <h3>${pkg.name}</h3>
                            <p class="price">Starting at ${CONFIG.CURRENCY}${pkg.price.toLocaleString()}</p>
                            <p class="description">${pkg.desc}</p>
                        </div>
                    </div>
                `;
            });
            residentialPackagesGrid.innerHTML = residentialHtml;

            // Update Commercial Packages
            let commercialHtml = '';
            const commercialPackages_list = [
                { id: 'small', name: 'Small Office', price: pricing.commercial.small.base, desc: 'For startups, clinics, small offices' },
                { id: 'standard', name: 'Standard Office', price: pricing.commercial.standard.base, desc: 'For corporate offices, law firms' },
                { id: 'large', name: 'Large Office', price: pricing.commercial.large.base, desc: 'For banks, ministries, hospitals' },
                { id: 'onetime', name: 'One-Time Deep Clean', price: pricing.commercial.onetime.base, desc: 'End-of-year, post-renovation' }
            ];
            
            commercialPackages_list.forEach(pkg => {
                commercialHtml += `
                    <div class="package-option ${currentCommercialPackage === pkg.id ? 'selected' : ''}" onclick="selectCommercialPackage('${pkg.id}')">
                        <input type="radio" name="commercialPackage" value="${pkg.id}" ${currentCommercialPackage === pkg.id ? 'checked' : ''} style="display: none;">
                        <div class="package-details">
                            <h3>${pkg.name}</h3>
                            <p class="price">Starting at ${CONFIG.CURRENCY}${pkg.price.toLocaleString()}</p>
                            <p class="description">${pkg.desc}</p>
                        </div>
                    </div>
                `;
            });
            commercialPackagesGrid.innerHTML = commercialHtml;
        }

        function calculateTotalHours() {
            let totalRooms = 0;
            
            if (currentPropertyType === 'residential') {
                const bedrooms = parseInt(document.getElementById('bedrooms')?.value) || 1;
                const bathrooms = parseInt(document.getElementById('bathrooms')?.value) || 1;
                const livingrooms = parseInt(document.getElementById('livingrooms')?.value) || 1;
                const kitchens = parseInt(document.getElementById('kitchens')?.value) || 1;
                const guestToilet = parseInt(document.getElementById('guestToilet')?.value) || 0;
                const laundry = parseInt(document.getElementById('laundry')?.value) || 0;
                const study = parseInt(document.getElementById('study')?.value) || 0;
                const store = parseInt(document.getElementById('store')?.value) || 0;
                
                totalRooms = bedrooms + bathrooms + livingrooms + kitchens + guestToilet + laundry + study + store;
            } else {
                const offices = parseInt(document.getElementById('offices')?.value) || 1;
                const restrooms = parseInt(document.getElementById('restrooms')?.value) || 1;
                const reception = parseInt(document.getElementById('reception')?.value) || 0;
                const kitchenette = parseInt(document.getElementById('commercialKitchen')?.value) || 0;
                const canteen = parseInt(document.getElementById('canteen')?.value) || 0;
                const lounge = parseInt(document.getElementById('lounge')?.value) || 0;
                const studyLibrary = parseInt(document.getElementById('studyLibrary')?.value) || 0;
                const laundryRoom = parseInt(document.getElementById('laundryRoom')?.value) || 0;
                const storeRoom = parseInt(document.getElementById('storeRoom')?.value) || 0;
                
                totalRooms = offices + restrooms + reception + kitchenette + canteen + lounge + 
                             studyLibrary + laundryRoom + storeRoom;
            }
            
            // Base: 3 hours + 1 hour per additional room beyond the 4 basic rooms
            const baseHours = 3;
            const additionalHours = Math.max(0, totalRooms - 4);
            return baseHours + additionalHours;
        }

        function calculateRequiredCleaners(totalHours) {
            if (totalHours <= 3) return 1;
            if (totalHours <= 6) return 2;
            if (totalHours <= 9) return 3;
            if (totalHours <= 12) return 4;
            if (totalHours <= 14) return 5;
            return 6;
        }

        function calculateStainRemoverCost() {
            const stainType = stainRemoverSelect.value;
            if (stainType === 'none') return 0;
            
            const totalHours = calculateTotalHours();
            const requiredCleaners = calculateRequiredCleaners(totalHours);
            
            // Stain remover cost scales with hours and cleaners
            let basePrice = 0;
            if (currentPropertyType === 'residential') {
                basePrice = stainRemoverPrices.residential[stainType] || 0;
            } else {
                basePrice = stainRemoverPrices.commercial[stainType] || 0;
            }
            
            // Multiply by hours factor (1.0 for base 3 hours, +0.1 per additional hour)
            const hourFactor = 1 + (Math.max(0, totalHours - 3) * 0.1);
            // Multiply by cleaners factor
            const cleanerFactor = requiredCleaners;
            
            return Math.round(basePrice * hourFactor * cleanerFactor);
        }

        function calculatePrice() {
            let basePrice = 0, roomCosts = 0, breakdown = [];
            
            if (currentPropertyType === 'residential') {
                const pkg = pricing.residential[currentResidentialPackage];
                basePrice = pkg.base;
                
                const bedrooms = parseInt(document.getElementById('bedrooms')?.value) || 1;
                const bathrooms = parseInt(document.getElementById('bathrooms')?.value) || 1;
                const livingrooms = parseInt(document.getElementById('livingrooms')?.value) || 1;
                const kitchens = parseInt(document.getElementById('kitchens')?.value) || 1;
                const guestToilet = parseInt(document.getElementById('guestToilet')?.value) || 0;
                const laundry = parseInt(document.getElementById('laundry')?.value) || 0;
                const study = parseInt(document.getElementById('study')?.value) || 0;
                const store = parseInt(document.getElementById('store')?.value) || 0;
                
                roomCosts = (bedrooms * pkg.rooms.bedroom) + (bathrooms * pkg.rooms.bathroom) +
                           (livingrooms * pkg.rooms.living) + (kitchens * pkg.rooms.kitchen) +
                           (guestToilet * (pkg.rooms.guestToilet || 0)) +
                           (laundry * (pkg.rooms.laundry || 0)) +
                           (study * (pkg.rooms.study || 0)) +
                           (store * (pkg.rooms.store || 0));
                
                if (bedrooms > 0) breakdown.push({ item: `Bedrooms (${bedrooms})`, cost: bedrooms * pkg.rooms.bedroom });
                if (bathrooms > 0) breakdown.push({ item: `Bathrooms (${bathrooms})`, cost: bathrooms * pkg.rooms.bathroom });
                if (livingrooms > 0) breakdown.push({ item: `Living Rooms (${livingrooms})`, cost: livingrooms * pkg.rooms.living });
                if (kitchens > 0) breakdown.push({ item: `Kitchens (${kitchens})`, cost: kitchens * pkg.rooms.kitchen });
                if (guestToilet > 0) breakdown.push({ item: `Guest Toilet (${guestToilet})`, cost: guestToilet * pkg.rooms.guestToilet });
                if (laundry > 0) breakdown.push({ item: `Laundry (${laundry})`, cost: laundry * pkg.rooms.laundry });
                if (study > 0) breakdown.push({ item: `Study (${study})`, cost: study * pkg.rooms.study });
                if (store > 0) breakdown.push({ item: `Store (${store})`, cost: store * pkg.rooms.store });
                
            } else {
                const pkg = pricing.commercial[currentCommercialPackage];
                basePrice = pkg.base;
                
                const offices = parseInt(document.getElementById('offices')?.value) || 1;
                const restrooms = parseInt(document.getElementById('restrooms')?.value) || 1;
                const reception = parseInt(document.getElementById('reception')?.value) || 0;
                const kitchenette = parseInt(document.getElementById('commercialKitchen')?.value) || 0;
                const canteen = parseInt(document.getElementById('canteen')?.value) || 0;
                const lounge = parseInt(document.getElementById('lounge')?.value) || 0;
                const studyLibrary = parseInt(document.getElementById('studyLibrary')?.value) || 0;
                const laundryRoom = parseInt(document.getElementById('laundryRoom')?.value) || 0;
                const storeRoom = parseInt(document.getElementById('storeRoom')?.value) || 0;
                
                roomCosts = (offices * pkg.rooms.office) + (restrooms * pkg.rooms.restroom) + 
                           (reception * (pkg.rooms.reception || 0)) +
                           (kitchenette * (pkg.rooms.kitchenette || 5000)) +
                           (canteen * (pkg.rooms.canteen || 14500)) +
                           (lounge * (pkg.rooms.lounge || 10000)) +
                           (studyLibrary * (pkg.rooms.studyLibrary || 8000)) +
                           (laundryRoom * (pkg.rooms.laundryRoom || 10000)) +
                           (storeRoom * (pkg.rooms.storeRoom || 8000));
                
                if (offices > 0) breakdown.push({ item: `Offices (${offices})`, cost: offices * pkg.rooms.office });
                if (restrooms > 0) breakdown.push({ item: `Restrooms (${restrooms})`, cost: restrooms * pkg.rooms.restroom });
                if (reception > 0) breakdown.push({ item: 'Reception', cost: pkg.rooms.reception });
                if (kitchenette > 0) breakdown.push({ item: `Kitchenette (${kitchenette})`, cost: kitchenette * 5000 });
                if (canteen > 0) breakdown.push({ item: `Canteen (${canteen})`, cost: canteen * 14500 });
                if (lounge > 0) breakdown.push({ item: `Lounge (${lounge})`, cost: lounge * 10000 });
                if (studyLibrary > 0) breakdown.push({ item: `Study/Library (${studyLibrary})`, cost: studyLibrary * 8000 });
                if (laundryRoom > 0) breakdown.push({ item: `Laundry Room (${laundryRoom})`, cost: laundryRoom * 10000 });
                if (storeRoom > 0) breakdown.push({ item: `Store Room (${storeRoom})`, cost: storeRoom * 8000 });
            }
            
            // Calculate hours and required cleaners
            const totalHours = calculateTotalHours();
            
            if (totalHours > 14) {
                alert('Total cleaning time exceeds 14 hours. Please contact us directly for a custom quote.');
                return 0;
            }
            
            const requiredCleaners = calculateRequiredCleaners(totalHours);
            
            // Add extra hours cost
            let extraHoursCost = 0;
            if (totalHours > 3) {
                const extraHours = totalHours - 3;
                const extraHourRate = currentPropertyType === 'residential' ? 
                    pricing.residential[currentResidentialPackage].extraHourRate :
                    pricing.commercial[currentCommercialPackage].extraHourRate;
                extraHoursCost = extraHours * extraHourRate;
                breakdown.push({ item: `Extra Hours (${extraHours} hrs)`, cost: extraHoursCost });
            }
            
            // Add auto-calculated additional cleaners
            let additionalCleanersAuto = requiredCleaners - 1; // Subtract the first cleaner
            if (additionalCleanersAuto > 0) {
                const cleanerCost = currentPropertyType === 'residential' ? 
                    additionalCleanersAuto * 5000 :
                    additionalCleanersAuto * additionalCleanerCost.commercial[currentCommercialPackage];
                breakdown.push({ item: `Required Additional Cleaners (${additionalCleanersAuto})`, cost: cleanerCost });
            }
            
            // Add manually requested additional cleaners
            const manualAdditionalCleaners = parseInt(document.getElementById('additionalCleaners')?.value) || 0;
            let manualCleanerCost = 0;
            if (manualAdditionalCleaners > 0) {
                if (currentPropertyType === 'residential') {
                    manualCleanerCost = manualAdditionalCleaners * 5000;
                } else {
                    manualCleanerCost = manualAdditionalCleaners * additionalCleanerCost.commercial[currentCommercialPackage];
                }
                breakdown.push({ item: `Manual Additional Cleaners (${manualAdditionalCleaners})`, cost: manualCleanerCost });
            }
            
            // Add add-ons
            let addonsTotal = 0;
            document.querySelectorAll('.addon-checkbox:checked').forEach(cb => {
                addonsTotal += parseFloat(cb.dataset.price);
                breakdown.push({ item: cb.dataset.name, cost: parseFloat(cb.dataset.price) });
            });
            
            // Add stain remover
            const stainRemoverCost = calculateStainRemoverCost();
            if (stainRemoverCost > 0) {
                const stainType = stainRemoverSelect.options[stainRemoverSelect.selectedIndex].text;
                breakdown.push({ item: stainType, cost: stainRemoverCost });
            }
            
            // Calculate subtotal
            let subtotal = basePrice + roomCosts + extraHoursCost + 
                          (additionalCleanersAuto > 0 ? additionalCleanersAuto * 
                           (currentPropertyType === 'residential' ? 5000 : additionalCleanerCost.commercial[currentCommercialPackage]) : 0) +
                          manualCleanerCost + addonsTotal + stainRemoverCost;
            
            breakdown.push({ item: 'Package Base', cost: basePrice });
            
            // Apply frequency discount
            const discountPercent = frequencyDiscounts[frequencySelect.value];
            const discountAmount = (subtotal * discountPercent) / 100;
            const total = subtotal - discountAmount;
            
            if (discountPercent > 0) breakdown.push({ item: `Discount (${discountPercent}%)`, cost: -discountAmount });
            
            // Add hours and cleaners info to breakdown
            breakdown.push({ item: `Estimated Time`, cost: `${totalHours} hours` });
            breakdown.push({ item: `Required Cleaners`, cost: requiredCleaners.toString() });
            
            totalPriceSpan.textContent = `${CONFIG.CURRENCY}${Math.round(total).toLocaleString()}`;
            
            let breakdownHtml = '<h3>Price Breakdown</h3>';
            breakdown.forEach(item => {
                if (typeof item.cost === 'number') {
                    breakdownHtml += `<div class="breakdown-item"><span>${item.item}</span><span>${CONFIG.CURRENCY}${Math.abs(item.cost).toLocaleString()}${item.cost < 0 ? ' discount' : ''}</span></div>`;
                } else {
                    breakdownHtml += `<div class="breakdown-item"><span>${item.item}</span><span>${item.cost}</span></div>`;
                }
            });
            breakdownHtml += `<div class="breakdown-item total"><span>Total</span><span>${CONFIG.CURRENCY}${Math.round(total).toLocaleString()}</span></div>`;
            priceBreakdown.innerHTML = breakdownHtml;
            
            return total;
        }

        // Package selection functions
        window.selectResidentialPackage = function(pkgId) {
            currentResidentialPackage = pkgId;
            document.querySelectorAll('input[name="residentialPackage"]').forEach(radio => {
                if (radio.value === pkgId) radio.checked = true;
            });
            updatePackages();
            calculatePrice();
            showPackageInfo('residential-' + pkgId);
        };

        window.selectCommercialPackage = function(pkgId) {
            currentCommercialPackage = pkgId;
            document.querySelectorAll('input[name="commercialPackage"]').forEach(radio => {
                if (radio.value === pkgId) radio.checked = true;
            });
            updatePackages();
            calculatePrice();
            showPackageInfo('commercial-' + pkgId);
        };

        // Modal functions
        window.showPackageInfo = function(packageId) {
            const info = packageInfo[packageId];
            if (!info) return;
            
            let html = `<h2>${info.title} <span class="package-badge">Details</span></h2>`;
            
            if (info.ideal) {
                html += `<div class="ideal-for"><strong>Ideal for:</strong> ${info.ideal}</div>`;
            }
            
            if (info.space) {
                html += `<p><strong>Space Size:</strong> ${info.space}</p>`;
            }
            
            if (info.staff) {
                html += `<p><strong>Staff Required:</strong> ${info.staff}</p>`;
            }
            
            if (info.duration) {
                html += `<p><strong>Duration:</strong> ${info.duration}</p>`;
            }
            
            if (info.note) {
                html += `<div class="important-note"><i class="fas fa-info-circle"></i> ${info.note}</div>`;
            }
            
            for (const [section, items] of Object.entries(info.sections)) {
                html += `<h3>${section}</h3><ul>`;
                items.forEach(item => {
                    html += `<li>${item}</li>`;
                });
                html += `</ul>`;
            }
            
            if (info.products) {
                html += `<h3>Recommended Products</h3>`;
                html += `<p class="note">Please note that these are only basic recommendations not hard requirements for your booking:</p>`;
                html += `<div class="products-grid">`;
                info.products.forEach(product => {
                    html += `<span class="product-item">${product}</span>`;
                });
                html += `</div>`;
            }
            
            if (info.notes && info.notes.length > 0) {
                html += `<div class="note"><strong>Important Notes:</strong>`;
                info.notes.forEach(note => {
                    html += `<p>• ${note}</p>`;
                });
                html += `</div>`;
            }
            
            modalContent.innerHTML = html;
            modal.style.display = 'block';
        };

        window.closeModal = function() {
            modal.style.display = 'none';
        };

        window.onclick = function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };

        // Property type selection
        residentialOption.addEventListener('click', function() {
            document.querySelector('input[name="propertyType"][value="residential"]').checked = true;
            residentialOption.classList.add('selected');
            commercialOption.classList.remove('selected');
            currentPropertyType = 'residential';
            residentialPackages.style.display = 'block';
            commercialPackages.style.display = 'none';
            residentialDetails.style.display = 'block';
            commercialDetails.style.display = 'none';
            updateAddons();
            calculatePrice();
        });

        commercialOption.addEventListener('click', function() {
            document.querySelector('input[name="propertyType"][value="commercial"]').checked = true;
            commercialOption.classList.add('selected');
            residentialOption.classList.remove('selected');
            currentPropertyType = 'commercial';
            residentialPackages.style.display = 'none';
            commercialPackages.style.display = 'block';
            residentialDetails.style.display = 'none';
            commercialDetails.style.display = 'block';
            updateAddons();
            calculatePrice();
        });

        // Initialize with residential selected
        residentialOption.classList.add('selected');

        function updateAddons() {
            const addonsList = currentPropertyType === 'residential' ? addons.residential : addons.commercial;
            let html = '';
            
            // Use default addons if not loaded from sheet
            const defaultAddons = currentPropertyType === 'residential' ? 
                [
                    { name: "Balcony Cleaning", price: 1000 },
                    { name: "Window Cleaning", price: 1400 },
                    { name: "Fridge Cleaning", price: 700 },
                    { name: "Fan Cleaning", price: 700 },
                    { name: "Oven Cleaning", price: 700 },
                    { name: "Kitchen Cabinet", price: 1000 },
                    { name: "Wall Cleaning", price: 2000 },
                    { name: "Ironing", price: 5600 },
                    { name: "Laundry", price: 2800 },
                    { name: "Wardrobe Organization", price: 4200 },
                    { name: "Compound Cleaning", price: 2800 },
                    { name: "Miscellaneous Hour", price: 2800 }
                ] : [
                    { name: "Kitchenette", price: 5000 },
                    { name: "Canteen", price: 14500 },
                    { name: "Lounge", price: 10000 },
                    { name: "Study/Library", price: 8000 },
                    { name: "Laundry Room", price: 10000 },
                    { name: "Store", price: 8000 },
                    { name: "Balcony Cleaning", price: 3000 },
                    { name: "Window Cleaning", price: 4500 },
                    { name: "Fridge Cleaning", price: 1500 },
                    { name: "Fan Cleaning", price: 1500 },
                    { name: "Kitchen Cabinet", price: 2000 },
                    { name: "Wall Cleaning", price: 9500 },
                    { name: "Compound Cleaning", price: 5800 },
                    { name: "Miscellaneous Hour", price: 5800 }
                ];
            
            const displayAddons = addonsList.length > 0 ? addonsList : defaultAddons;
            
            displayAddons.forEach((addon) => {
                html += `
                    <label class="addon-item">
                        <input type="checkbox" class="addon-checkbox" data-price="${addon.price}" data-name="${addon.name}">
                        <span class="addon-name">${addon.name}</span>
                        <span class="addon-price">${CONFIG.CURRENCY}${addon.price.toLocaleString()}</span>
                    </label>
                `;
            });
            
            addonsContainer.innerHTML = html;
            document.querySelectorAll('.addon-checkbox').forEach(cb => cb.addEventListener('change', calculatePrice));
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadPricingData();
            setupEventListeners();
        });

        function setupEventListeners() {
            const inputs = ['bedrooms', 'bathrooms', 'livingrooms', 'kitchens', 'guestToilet', 'laundry', 'study', 'store',
                           'offices', 'restrooms', 'reception', 'commercialKitchen', 'canteen', 'lounge', 'studyLibrary', 
                           'laundryRoom', 'storeRoom', 'additionalCleaners'];
            
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.addEventListener('input', calculatePrice);
            });

            frequencySelect.addEventListener('change', calculatePrice);
            stainRemoverSelect.addEventListener('change', calculatePrice);
            submitBtn.addEventListener('click', submitForm);
        }

        function validateForm() {
            let isValid = true;
            document.querySelectorAll('.error-message').forEach(msg => msg.style.display = 'none');
            
            if (!document.getElementById('fullName').value.trim()) {
                document.getElementById('nameError').style.display = 'block';
                isValid = false;
            }
            const email = document.getElementById('email').value.trim();
            if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                document.getElementById('emailError').style.display = 'block';
                isValid = false;
            }
            if (!document.getElementById('phone').value.trim()) {
                document.getElementById('phoneError').style.display = 'block';
                isValid = false;
            }
            if (!document.getElementById('address').value.trim()) {
                document.getElementById('addressError').style.display = 'block';
                isValid = false;
            }
            return isValid;
        }

        function submitForm() {
            if (!validateForm()) return;
            
            loadingOverlay.style.display = 'flex';
            const total = calculatePrice();
            
            if (total === 0) {
                loadingOverlay.style.display = 'none';
                return;
            }
            
            const selectedAddons = [];
            document.querySelectorAll('.addon-checkbox:checked').forEach(cb => selectedAddons.push(cb.dataset.name));
            
            // Add stain remover if selected
            if (stainRemoverSelect.value !== 'none') {
                selectedAddons.push(stainRemoverSelect.options[stainRemoverSelect.selectedIndex].text);
            }
            
            // Get room details string
            let roomsString = '';
            if (currentPropertyType === 'residential') {
                roomsString = `Bed:${document.getElementById('bedrooms').value}, Bath:${document.getElementById('bathrooms').value}, ` +
                             `Living:${document.getElementById('livingrooms').value}, Kitchen:${document.getElementById('kitchens').value}, ` +
                             `Guest Toilet:${document.getElementById('guestToilet').value}, Laundry:${document.getElementById('laundry').value}, ` +
                             `Study:${document.getElementById('study').value}, Store:${document.getElementById('store').value}`;
            } else {
                roomsString = `Offices:${document.getElementById('offices').value}, Restrooms:${document.getElementById('restrooms').value}, ` +
                             `Reception:${document.getElementById('reception').value === '1' ? 'Yes' : 'No'}, ` +
                             `Kitchenette:${document.getElementById('commercialKitchen').value}, Canteen:${document.getElementById('canteen').value}, ` +
                             `Lounge:${document.getElementById('lounge').value}, Study/Library:${document.getElementById('studyLibrary').value}, ` +
                             `Laundry Room:${document.getElementById('laundryRoom').value}, Store Room:${document.getElementById('storeRoom').value}`;
            }
            
            const formData = new URLSearchParams({
                action: 'submitQuote',
                secretToken: CONFIG.API_SECRET_TOKEN,
                fullName: document.getElementById('fullName').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                address: document.getElementById('address').value.trim(),
                propertyType: currentPropertyType === 'residential' ? 'Residential' : 'Commercial',
                package: currentPropertyType === 'residential' ? 
                    (currentResidentialPackage === 'standard' ? 'Standard Cleaning' : 
                     currentResidentialPackage === 'deep' ? 'Deep Cleaning' : 'Move-In Cleaning') :
                    (currentCommercialPackage === 'small' ? 'Small Office' :
                     currentCommercialPackage === 'standard' ? 'Standard Office' :
                     currentCommercialPackage === 'large' ? 'Large Office' : 'One-Time Deep Clean'),
                frequency: frequencySelect.options[frequencySelect.selectedIndex].text,
                rooms: roomsString,
                addons: selectedAddons.join(', ') || 'None',
                additionalCleaners: document.getElementById('additionalCleaners').value || '0',
                totalHours: calculateTotalHours().toString(),
                requiredCleaners: calculateRequiredCleaners(calculateTotalHours()).toString(),
                totalAmount: `${CONFIG.CURRENCY}${Math.round(total).toLocaleString()}`
            });

            const script = document.createElement('script');
            const callbackName = 'jsonpCallback_' + Date.now();
            
            window[callbackName] = function(response) {
                delete window[callbackName];
                document.body.removeChild(script);
                loadingOverlay.style.display = 'none';
                if (response && response.result === 'success') {
                    successMessage.style.display = 'block';
                    setTimeout(() => successMessage.style.display = 'none', 3000);
                } else {
                    alert('Error submitting quote. Please call ' + CONFIG.COMPANY_PHONE);
                }
            };
            
            script.src = CONFIG.API_URL + '?callback=' + callbackName + '&' + formData.toString();
            script.onerror = function() {
                loadingOverlay.style.display = 'none';
                alert('Error submitting. Please call ' + CONFIG.COMPANY_PHONE);
            };
            document.body.appendChild(script);
        }
    </script>
</body>
</html>